FROM ubuntu:18.04

RUN mkdir -p /opt/built

# prevent failures due to interactive apt transactions
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get -y update
RUN apt-get -y upgrade

RUN \
apt-get -y install git gcc g++ autoconf automake libtool dh-python debhelper pkg-config python3-setuptools \
                   libxml2-dev uuid-dev \
                   python3-protobuf protobuf-compiler libprotobuf-dev \
                   python3-zmq libzmq5 libzmq3-dev \
                   python3-dev python3-lxml sqlite3 libsqlite3-dev

WORKDIR /opt
RUN git clone https://github.com/adjacentlink/opentestpoint -b develop

WORKDIR opentestpoint
RUN ./autogen.sh
RUN ./configure
RUN make deb
RUN cp $(find .debbuild -name "*\.deb") /opt/built
RUN dpkg -i /opt/built/python3*\.deb /opt/built/emane*\.deb; apt-get -y install -f

RUN echo 'complete'

